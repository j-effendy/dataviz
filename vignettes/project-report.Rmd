---
title: "Project Report"
author: "Jimmy Effendy"
date: "13/10/2021"
output: bookdown::pdf_document2
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(ggplot2)
library(tidyverse)
library(dataviz)
library(colorspace)
library(patchwork)
library(pals)
```

# Introduction (300)

According to Cleveland and McGill [-@cleveland1985graphical], data visualizations 
are effective tools for communicating quantitative information and presenting 
scientific data.

The aim of this project is to create a package that can produce figures that
are aesthetically cohesive for a textbook in an automatic and reproducible
manner. As these graphs are generally aimed to be consumed by other people, it
is important for the aesthetics to be engaging. More importantly, the style of 
the graphs needs to make it easier for users to compare and explore data.

# Themes (1500)

## What makes visualisations good? (300)

Azzam, Evergree, and Germuth [-@azzam2013data] stated that data visualization
is defined by three criteria: 

* A process that is based quantitative or qualitative data
* The result of the process is a graph that is representative of the raw data
* The graph is readable and support exploration, examination, and communications
of data.

Without careful considerations, data visualisation has the 
potential to cause confusion resulting in misunderstanding or error in decision
makings [@evergreen2011]. In addition, inefficient visual decoding may result in
users to not detect important aspect of the data [@cleveland1993model]. 
Unfortunately, inefficient graphs are not uncommon occurrence, especially with 
increasing number of options in data visualizations over the years. Tufte 
[-@tufte2001visual] found that prevalent errors and data misrepresentation were 
found in mass media. Another study found that 30% of graphs found in Volume 207 
(1980) of *Science* have one or more type of errors [@cleveland1984graphs].

With widespread error in data visualizations, guidelines for better graphs
for quantitative and qualitative data were established. According to Tufte 
[-@tufte2001visual], visualizations need to bring viewers' attention to the 
substance of the data as opposed to graphic design, methodology or something 
else. In addition, graphs should prevent distortion of the data and should 
encourage viewers to compare different parts of data. Another suggestion from 
Tufte is to avoid the usage of chartjunk. Chartjunk is any decorations that do 
not provide new information to readers. This can easily cause viewers to be 
confused or distracted from the data. Some examples of chartjunk are moir√© 
effect, heavy grid lines, noisy background, a fake perspective (i.e. 3-D charts).

Cleveland and McGill [-@cleveland1984graphical] conducted a study of effective
data visualization based on graphical perception - humans' ability to visually
decode information encoded on graphs. In the study, people are given elementary
perceptual tasks to decode information from graphs. The tasks are then ordered
based on the accuracy of the performance. The order of the elementary tasks from 
most to least accurate is:

* Position along a common scale
* Positions along nonaligned scales
* Length, direction, angle
* Area
* Volume, curvature
* Shading, color saturation

## Roles of themes in data visualisation (300)

Themes in `ggplot` package refers to **non-data** components of data visualizations.
Themes allow users to customize plot background and title, axis line, ticks and 
title, legend position, background, and title, grid lines, etc. On default,
`ggplot` use `theme_grey` for every plots. However, `ggplot` provides other
complete themes that users can use, such as `theme_bw()` and `theme_minimal()`.

Theme is especially important for a research book where there are many authors
contributing to the book. Without a set theme, it is likely that each author 
will apply their own visualization styles for their research. Not only setting 
a theme for a research book allows authors not to spend their time to 
customize their plots' appearance, but it also allows research books to 
have consistency in their visualizations.

As stated in previous section, customizing plot themes is imperative in data 
visualizations as non-data components impacts readers' ability to comprehend the 
graph.

Give plot examples.

## Criteria for good themes (300)

Tufte [-@tufte2001visual] introduced the term data-ink in his book. Data-ink
is defined as a non-redundant ink; it is ink used on a graph that represent
the underlying data. 

$$
\begin{aligned}
Data-ink ratio = \frac{data-ink}{total ink used to print the graphic}
\end{aligned}
$$

Five principles of data graphics in relation to data-ink are proposed by Tufte:

* Above all else show the data
* Maximize the data-ink ratio
* Erase non-data-ink, within reason
* Erase redundant data-ink
* Revise and edit

Two of these principles are related to non-data components of visualizations.
Good graphical representations can be achieved by reducing non-data ink as this
a way to maximize data-ink ratio. Graphical inks that provide no new information
about the underlying data are not beneficial to readers and sometimes result
graphical clutters. However, maximizing data-ink ratio needs to be done 
cautiously as components of the graph that provide useful information can be 
mistakenly removed.

Design choices on data visualizations need to allow information presented in an
organised fashion. For example, the color of non-data components (axis, labels, 
grid lines, borders) can be grey, and the data component can be brightly
colored, making the data to be the focus of attention [@stone2006choosing]. 
This will assist readers to better understand the roles and relationship between 
different elements of the visualizations.

## Potential themes (300)

```{r scatter-grey, fig.cap="A scatter plot example with 'theme_grey()'", fig.height=5, fig.width=5}
g1 <- ggplot(mtcars, aes(mpg,disp,color=factor(carb))) + 
  geom_point(size=3) + 
  labs(title="Scatter Plot",
       subtitle = "theme_grey()",
       caption = "Data: mtcars")

g1
```

`theme_grey()` is the default `ggplot2` theme with grey background and white 
grid lines. These color combinations reduces the contrast between the background 
and grid lines and gives the data plots more value-added appearance 
[@carr1994using]. While having a grey background and white grid
lines have their benefits, some steps can be made to improve the theme. As
shown in figure \@ref(fig:scatter-grey), having a grey panel background  
on top of a white plot background unnecessarily increase non-data components.
In addition, having both major and minor grid lines distracts readers from the
real data, and rarely needed as data visualizations are not meant to provide
precise quantitative value [@few2005grid].

A ggplot theme is developed in `dataviz` package that is not only based on 
Tufte principles of data graphics, but also to create a theme that is suitable 
for a wide range of plots. There are two potential themes that were developed for 
`dataviz`: `theme_seagull()` and `theme_wombat()`.

### theme_seagull

```{r seagull-scatter, fig.cap="A scatter plot example with 'theme_seagull()'", fig.height=5, fig.width=5}
s1 <- ggplot(mtcars, aes(mpg,disp,color=factor(carb))) + 
  geom_point(size=3) + 
  labs(title="Scatter Plot",
       subtitle = "theme_seagull()",
       caption = "Data: mtcars") +
  theme_seagull()

s1
```

This `ggplot2` theme is built based on `theme_minmal()`. The idea behind this
theme is to reduce non-data components as much as possible by maximizing white 
space around the plot. `%+replace%` operator is used to change the elements of 
the plots. Axis line on the y axis is removed, and axis line on the x axis is 
thicker. The major vertical grid lines and minor grid lines on both axis are removed. 
The grid lines, as shown in figure \@ref(fig:seagull-scatter), are visually 
muted so that it does not distract the data points. Cleveland 
[-@cleveland1993visualizing] found that grid lines enhance readers' perceptions 
in making visual comparison and accuracy of information extraction. 

### theme_wombat

```{r wombat-scatter, fig.cap="A scatter plot example with 'theme_wombat()'", fig.height=5, fig.width=5}
w1 <- ggplot(mtcars, aes(mpg,disp,color=factor(carb))) + 
  geom_point(size=3) + 
  labs(title="Scatter Plot",
       subtitle = "theme_wombat()",
       caption = "Data: mtcars") +
  theme_wombat()

w1
```

Another potential theme for `dataviz` package is called `theme_wombat()`.
This theme is developed  based on `ggplot2` basic theme `theme_bw()`. 
`%+replace%` operator is also used to develop `theme_wombat()`. Minor grid 
lines on both axis are removed for this theme. Similar to `theme_seagull()`, 
`theme_wombat()` has white background and light grey grid lines.

## Themes Comparison

This section is going to compare the potential themes `theme_seagull()` and
`theme_wombat()` with `ggplot2` built in theme, `theme_bw()`. `theme_bw` is
chosen for this comparison as it is one of the built-in themes that minimizes
non-data components while still preserving light colored grid lines.

```{r theme-comparison, fig.cap="Comparison between theme_seagull (left), theme_wombat (middle), and theme_bw (right).", fig.height=14, fig.width=11}
w2 <- ggplot(mtcars, aes(factor(carb),fill=factor(carb))) + 
  geom_bar() + 
  scale_y_continuous(expand = c(0,0)) + 
  scale_x_discrete(expand = c(0,0)) +
  labs(title="Bar Plot",
       subtitle = "theme_wombat()",
       caption = "Data: mtcars") +
  theme_wombat()

w3 <- ggplot(economics_long, aes(date, value01, colour = variable)) +
  geom_line() +
   scale_y_continuous(expand = c(0,0)) + 
   scale_x_date(expand = c(0,0)) +
  labs(title = "Line Plot",
       subtitle = "theme_wombat()",
       caption = "Data: economics_long") +
  theme_wombat()

s2 <- ggplot(mtcars, aes(factor(carb),fill=factor(carb))) + 
  geom_bar() + 
  scale_y_continuous(expand = c(0,0)) + 
  scale_x_discrete(expand = c(0,0)) +
  labs(title="Bar Plot",
       subtitle = "theme_seagull()",
       caption = "Data: mtcars") +
  theme_seagull()

s3 <- ggplot(economics_long, aes(date, value01, colour = variable)) +
  geom_line() +
  scale_y_continuous(expand = c(0,0)) + 
  scale_x_date(expand = c(0,0)) +
  labs(title = "Line Plot",
       subtitle = "theme_seagull()",
       caption = "Data: economics_long") +
  theme_seagull()

bw1 <- ggplot(mtcars, aes(mpg,disp,color=factor(carb))) + 
  geom_point(size=3) + 
  labs(title="Scatter Plot",
       subtitle = "theme_bw()",
       caption = "Data: mtcars") +
  theme_bw()

bw2 <- ggplot(mtcars, aes(factor(carb),fill=factor(carb))) + 
  geom_bar() + 
  labs(title="Bar Plot",
       subtitle = "theme_bw()",
       caption = "Data: mtcars") +
  theme_bw()

bw3 <- ggplot(economics_long, aes(date, value01, colour = variable)) +
  geom_line() +
  labs(title = "Line Plot",
       subtitle = "theme_bw()",
       caption = "Data: economics_long") +
  theme_bw()

(s1 + w1 + bw1) / (s2 + w2 + bw2) / (s3 + w3 + bw3)
```

### Comparison with `theme_bw()`

Side by side comparison of scatter plots, bar charts, and line charts between
the three themes can be found in figure \@ref(fig:theme-comparison). One of 
the differences between `dataviz` potential themes and `theme_bw()` is the size
of the text. The axis title, plot title, subtitle, and caption with 
`theme_seagull()` and `theme_wombat()` are easier to read in comparison to
`theme_bw()`. Secondly, the legend position is located on the bottom of the
plot as opposed to the right of the plot. The reason to the change in legend
position is to maximize the data-ink ratio of the plots. Putting the legend
on the right of the plot takes up the space that can be used to display the
underlying data. Another way of maximizing data-ink ratio is by reducing
the margin around the plot. As shown in the bar plots and line plots in figure \@ref(fig:theme-comparison), there are no extra space between the bars/lines 
with the axis lines in the plots with `theme_seagull()` and `theme_wombat()`.

### Advantages and Disadvantages - `theme_seagull()`

One of the objectives of `theme_seagull()` is to have a theme that increases 
data-ink ratio as much as possible. In comparison to other two themes, 
`theme_seagull()` has the least amount of grid lines and borders around the
plot, making it to have the highest data-ink ratio. While there is no vertical 
grid lines, major horizontal grid lines are preserved as they aid readers to 
approximate and compare values between data points.

### Advantages and Disadvantages - `theme_wombat()`

`theme_wombat()` is developed to be the middle ground between `theme_seagull()`
and `theme_bw()`. In comparison to the `ggplot2` built-in theme, this theme
is less cluttered as it does not have minor grid lines on both axis. Unlike
`theme_seagull()`, however, this theme retains major vertical grid lines.

### The Best Theme

As stated above, `theme_seagull()` has the least clutters between the two 
potential themes. However, `theme_wombat()` is likely to assist readers
to perform comparative exercise more accurately comparative to `theme_seagull()`
while still maintaining a high level of data-ink ratio. Using the scatter plot 
example in figure \@ref(fig:theme-comparison), the major vertical grid lines 
from `theme_wombat()` aids readers estimate the value of data points along the
x axis. This shows that `theme_wombat()` is a good compromise of minimizing 
clutters as well as allowing readers to extract information from the graph as 
much as possible.

\newpage
* Compare with each other and basic theme
* Advantage and disadvantage

### Faceted Plots

```{r wombat-facet, fig.height=14, fig.width=11, fig.cap="Comparison between theme_wombat (top) and theme_bw (bottom) for faceted plot."}
w4 <- ggplot(data = mpg,aes(cty, hwy,color=drv))+geom_point(size=3) + 
  facet_wrap(~ class,scales="free")+
  labs(title="Plot With Facets",
       subtitle = "theme_wombat()",
       caption = "Data: mpg") + 
  theme_wombat()

bw4 <- ggplot(data = mpg,aes(cty, hwy,color=drv))+geom_point(size=3) + 
  facet_wrap(~ class,scales="free")+
  labs(title="Plot With Facets",
       subtitle = "theme_bw()",
       caption = "Data: mpg") + 
  theme_bw()

w4 / bw4
```

```{r seagull-facet, fig.height=14, fig.width=11, fig.cap="Comparison between theme_seagull (top) and theme_minimal (bottom) for faceted plot."}
s4 <- ggplot(data = mpg,aes(cty, hwy,color=drv))+geom_point(size=3) + 
  facet_wrap(~ class,scales="free")+
  labs(title="Plot With Facets",
       subtitle = "theme_seagull()",
       caption = "Data: mpg") + 
  theme_seagull()

m4 <- ggplot(data = mpg,aes(cty, hwy,color=drv))+geom_point(size=3) + 
  facet_wrap(~ class,scales="free")+
  labs(title="Plot With Facets",
       subtitle = "theme_minimal()",
       caption = "Data: mpg") + 
  theme_minimal()

s4 / m4
```


# Choosing Color Palletes

In addition to themes, color also plays an important role in data 
visualizations. Proper use of color in a visualization enhances the quality
of information being presented [-@zeileis2009escaping]. One of the most important
use of color in data visualizations is to differentiate one element from one
another [@stone2006choosing]. A poor choice of color palette can impede viewers' 
ability to effectively extract information from the visualization. 

With a simple visual features, some objects can be easily recognised compared
to other objects without requiring attention. The target object will "pop out" 
in field of vision regardless how many distractors surround it 
[@treisman1985preattentive]. The use of color in data visualisation can facilitate
this "pop-out" as it makes it can make some elements to be easier to be found.

```{r pop-out, fig.cap="It is easier to find the odd ones by using color"}
set.seed(20211028)

x <- rnorm(20)
y <- rnorm(20)
color <- c("red","red","blue","red","blue","red","red","red","red","red","red",
           "blue","red","red","red","red","red","red","red","red")
pop_out <- data.frame(x,y,color)

p1 <- pop_out %>% ggplot(aes(x = x,
                             y = y,
                             color = color)) +
  geom_point() +
  theme_wombat() +
  theme(legend.position = "none",
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  ggtitle("Color")

p2 <- pop_out %>% ggplot(aes(x = x,
                             y = y,
                             shape = color)) +
  geom_point() +
  theme_wombat() +
  theme(legend.position = "none",
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  ggtitle("Shape")

p1 + p2
```

Figure \@ref(fig:pop-out) contains three "odd" observations that are different 
than the rest. To represent this, the first panel uses color to differentiate 
the different kinds of observations. The three observations are colored red, and
the rest are blue. On the other hand, the second panel uses shape to represent
this feature. Circle is used to represent the "odd" observations, and triangle is
used for the rest. While readers have no problem in identifying the three 
observations in the second panel, it is much easier to find these observations 
on the first panel. It only requires low level of attention to find the observation
of interest in the first panel.

In addition to assisting viewers in differentiating one attribute to another, 
colors can also be used to evoke viewers' emotions. Emotion is important
in visualizations for story telling, communicative intent, and engagement
[@bartram2017affective].  It was also found that emotions can significantly 
improve many cognitive processes such as attention, learning, decision making, 
and problem-solving [@harrison2012exploring].

## Color Spaces

To effectively use colors in visualizations, it is imperative to understand
how human color perception works. It was theorized that human color vision evolved 
in three distinct stages [@ihaka2003colour]: 

1. Perception of light and dark (monochrome)
2. Perception of yellow/blue contrast
3. Perception of green/red contrast

As a result of these three color axes, colors are naturally described as 
locations in a three dimensional space. While these color axis provide 
physiological description, human perception of colors do not corresponds to
these axes. Human perception of color corresponds to the polar coordinates
of the color coordinate (yellow/blue and green/red), and a dark/light axis 
[@zeileis2006choosing]:

1. Hue: dominant wavelength
2. Chroma: colorfulness (color intensity)
3. Luminance: brightness (brightness)

Unfortunately, not all software packages use color space developed based on
human perception. For example, the most common color map used by software 
packages, the Red-Green-Blue (RGB) [@stauffer2015somewhere], was primarily 
developed to correspond with color generation on computer screens rather than 
to correspond with human perception of color [@zeileis2009escaping]. 
Zeileis, Hornik, and Murrell further stated that it is practically impossible
for a human to control the perceptual properties of a color within this color 
model as there is no single dimension that relates to hue or brightness of a 
color

One popular alternative to RGB system is Hue-Saturation-Value (HSV). This model
is a simple transformation of RGB system and aims to capture the dimensions of 
human visual perceptions [@smith1978color]. Unfortunately, the result of mapping 
HSV's three dimensions to three dimensions of human perceptions is very poor
[@zeileis2006choosing]. Moreover, it is fairly difficult set HSV coordinates for 
colors that are in harmony [@zeileis2006choosing]. Furthermore, HSV encourages 
the use of colors that are highly saturated. While these colors are good to 
attract viewers' attention, it is difficult to look at for a long time 
[@zeileis2009escaping].

HCL, which is short for Hue-Chroma-Luminance, was developed to overcome many 
problems encountered by other color spaces. This color space is developed
based on the three color attributes that corresponds to human perceptions:
hue, chroma, and luminance [@sarifuddin2005new]. It was found that the three
dimensions from this color space matches human visual perception well 
[@zeileis2019colorspace]. In general, HCL color space can be used to generate 
three types of color scales: qualitative, sequential, and diverging.

## Types of Color Palettes (300)

### Qualitative Palettes

This color palette is designed for coding categorical information where the 
categories do not have particular ordering [@zeileis2019colorspace]. In other
words, this color palette will give the same perceptual weight to each category
so that there will be no perception of one group to be larger or more important
than any other one [@zeileis2006choosing]. This color palette is commonly applied
to bar plots or box plots.

### Sequential Palettes

Sequential pallets are used for coding ordered/numerical information that span
in a certain interval [@zeileis2006choosing]. The low values of the interval
are considered to be uninteresting, whereas high values are considered to be 
interesting [@zeileis2019colorspace]. Low values are usually depicted by lighter
colors, while darker colors are used for high values [@harrower2003colorbrewer].
This palette is usually used on heatmaps.

### Diverging Palletes

Similar to sequential palette, diverging pallets are designed for coding ordered/
numerical information that ranges in an interval. The difference between 
diverging and sequential palletes is that diverging pallets include a neutral
value [@zeileis2006choosing]. This palette should be used when an important data
class or break points need to be highlighted [@harrower2003colorbrewer]. Harrower 
and Brewer further stated that this critical data class or break points is 
highlighted by a change in in hue and luminance, and should represent a critical 
value of the data (e.g. mean, median, or zero). For instance, the average GDP
per capita in a choropleth map can be emphasised (set as neutral value) so that
the values above and below the average can be shown in different hues.

## Color palette of choice

### Sequential (200)

* Hue is increasing in a very smooth pattern. More prefer to use this for
* sequential for ordering
* Can talk about how Brewer did these color palettes

```{r seal}
seal_palette <- colorspace::sequential_hcl(7,
                                              h = c(0, -100),
                                              c = c(80,40),
                                              l = c(40, 75),
                                              power = c(1,1))

# color spectrum plot
specplot(seal_palette) 
# colorblind filter
pal.safe(seal_palette, main = "seal_palette")
```


```{r snake}
snake_palette <- colorspace::sequential_hcl(6,
                                              h = c(250, 90),
                                              c = c(40, 55),
                                              l = c(33,98),
                                              power = c(0.5,1),
                                              rev = TRUE)

# color spectrum plot
specplot(snake_palette)
# colorblind filter
pal.safe(snake_palette, main = "snake_palette")
```

* How did we choose them?
* Come from another package?
* How do we assess them?

* Talk about the HCL plot
* Talk about the accessibility
* Talk about how it should match the data

### Diverging (200)

```{r dingo}
dingo_palette <- colorspace::diverge_hcl(7,
                                           h = c(260, 0),
                                           c = 80,
                                           l = c(30, 90),
                                           power = 1.5)

# color spectrum plot
specplot(dingo_palette)
# colorblind filter
pal.safe(dingo_palette, main = "dingo_palette")
```

```{r dolphin}
# make the purple darker (modify hue)
dolphin_palette <- colorspace::diverging_hcl(n = 7,
                                             h = c(265, 45),
                                             c = 80,
                                             l = c(70, 95),
                                             power = c(0.5, 2),
                                             rev = TRUE)

# color spectrum plot
specplot(dolphin_palette)
# colorblind filter
pal.safe(dolphin_palette, main = "dolphin_palette")
```

### Qualitative (200)

* for qualitative, we need more variation in the hue line. Need to avoid
* implicit ordering
* make chroma and luminance to have patterns (but not the same with the others)

```{r other-qualitative}
brewer_qualitative <- c("#a6cee3", "#1f78b4", "#b2df8a", "#33a02c")
tol_qualitative <- c("#4477AA", "#EE6677", "#228833", "#CCBB44", "#66CCEE", "#AA3377", "#BBBBBB")
```

```{r quokka}
quokka_palette <- c("#8C01E6", "#93B1EB", "#AB313D", "#D6CA24")

# color spectrum plot
specplot(quokka_palette)
# colorblind filter
pal.safe(quokka_palette, main = "quokka_palette")
```
Not ideal for Deutan and Protan because some of the colors looked paired.

```{r quoll}
quoll_palette <- c('#8D5698', '#EFD36F', '#247A3E', '#17B0A8')

# color spectrum plot
specplot(quoll_palette)
# colorblind filter
pal.safe(quoll_palette, main = "quoll_palette")
```

# R Package (1500)

## Components of R Package

## How dataviz was created

## Testing

# Conclusion (300)
